####################??????TPM:Transcripts Per Kilobase of exon model per Million mapped reads 
#https://www.jianshu.com/p/1940c5954c81
#TPMi=(Ni/Li)*1000000/sum(Ni/Li+....+ Nm/Lm) 
#Ni:mapping?????????i??????read???; Li:??????i???????????????????????????
#????????????????????????,?????????????????????????????????
ct=fread("counts.txt",head=T,data.table=F,skip=1)
exon_l=ct[,6]
ct[,1]=gsub("gene:","",ct[,1])
rownames(ct)=ct[,1]
ct=ct[,-c(1:6)]
rpk=ct/(exon_l/1000)
tpm <- t(t(rpk)/colSums(rpk) * 1000000)
write.csv(tpm,"TPM_Old_new_four_lines.csv",quote = F,row.names = T) # ???????????????

#############FPKM??????
ct=fread("counts.txt",head=T,data.table=F,skip=1)
exon_l=ct[,6]
ct[,1]=gsub("gene:","",ct[,1])
rownames(ct)=ct[,1]
ct=ct[,-c(1:6)]
rpk=ct/(exon_l/1000)
total_r=colSums(ct)/1000000
FPKM=t(t(rpk)/total_r)
write.csv(FPKM,"FPKM_Old_new_four_lines.csv",quote = F,row.names = T) # ???????????????
