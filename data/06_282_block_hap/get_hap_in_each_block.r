library(data.table)
g=fread("Block.txt", header=T,data.table=F)
id=fread("282_pop_structure.txt", header=F,data.table=F)
nss=id[id[,2]=="nss",1]
ss=id[id[,2]=="ss",1]
d=fread("Glu.hmp321_282_agpv4_maf005_miss03.vcf2", header=T,data.table=F)
res=NULL
for(i in unique(g[,6]))
{
  g1=g[g[,6]==i,]
  d1=d[d[,2]>=min(g1[,4]) & d[,2]<=max(g1[,4]),]
  d2=d1[,-c(1:9)]
  # Ward????????????
  d3 <- dist(t(d2), method = "euclidean") # ??????????????????????????????????????????
  fit2 <- hclust(d3, method="ward.D") #??????Ward????????????
  pdf("Blk6.pdf",height = 10,width = 35)
  plot(fit2) # ?????????????????????????????????
  groups <- cutree(fit2, k=4) # ?????????????????????3
  # ????????????3???????????????????????????
  rect.hclust(fit2, k=4, border="red")
  dev.off()
  grp=cbind(colnames(d2),groups)
  colnames(grp)=c("ID","Hap")
  table(grp[,2])
  write.table(grp,"blk6_hap.txt",col.names = T,row.names = F,quote = F,sep="\t")
}
