install.packages("GHap")
library(GHap)
library(data.table)
library(Ropt)
phase <- ghap.loadphase(
samples.file = "human.samples",
markers.file = "human.markers",
phase.file = "human.phase"
)
write.table(markers,"markers_maf005.txt",col.names = F,row.names = F,quote = F,sep="\t")
mk=fread("Glu.markers", header=T,data.table=F)
setwd("E:/UNL_Yang_lab/N_treatment_Jing/05Conbine_GWAS_Sele_GCTB_hmp/Chr5/genotype/hapmap_analysis/GHap/02get_input")
mk=fread("Glu.markers", header=T,data.table=F)
head(mk)
mk=fread("Glu.markers", header=F,data.table=F)
mk005=fread("markers_maf005.txt", header=F,data.table=F)
mk1=merge(mk,mk005)
colnames(mk)[2]="snp"
colnames(mk005)[1]="snp"
mk1=merge(mk,mk005,by="snp")
View(mk1)
bk=fread("Block.txt", header=T,data.table=F)
head(bk)
i=1
d1=bk[bk[,6]==i,]
head(mk1)
d2=mk1[mk1[,3]>=s & mk1[,3]<=e,]
s=min(bk[,4])
e=max(bk[,4])
d2=mk1[mk1[,3]>=s & mk1[,3]<=e,]
View(d2)
head(d2)
re=NULL
for(i in unique(bk[,6]))
{
d1=bk[bk[,6]==i,]
s=min(bk[,4])
e=max(bk[,4])
size=e-s+1
d2=mk1[mk1[,3]>=s & mk1[,3]<=e,]
r=c(qq("BK{i}"),d2[1,2],s,e,size,nrow(d2))
re=rbind(re,r)
}
View(re)
View(bk)
i
View(d1)
re=NULL
for(i in unique(bk[,6]))
{
d1=bk[bk[,6]==i,]
s=min(d1[,4])
e=max(d1[,4])
size=e-s+1
d2=mk1[mk1[,3]>=s & mk1[,3]<=e,]
r=c(qq("BK{i}"),d2[1,2],s,e,size,nrow(d2))
re=rbind(re,r)
{
d1=bk[bk[,6]==i,]
s=min(d1[,4])
e=max(d1[,4])
size=e-s+1
d2=mk1[mk1[,3]>=s & mk1[,3]<=e,]
r=c(qq("BK{i}"),d2[1,2],s,e,size,nrow(d2))
re=rbind(re,r)
}
)
re=NULL
for(i in unique(bk[,6]))
{
d1=bk[bk[,6]==i,]
s=min(d1[,4])
e=max(d1[,4])
size=e-s+1
d2=mk1[mk1[,3]>=s & mk1[,3]<=e,]
r=c(qq("BK{i}"),d2[1,2],s,e,size,nrow(d2))
re=rbind(re,r)
}
View(re)
View(bk)
colnames(re)=c("BLOCK","CHR","BP1","BP2","SIZE","NSNP")
write.table(re,"input_block.txt",col.names = T,row.names = F,quote = F,sep="\t")
setwd("E:/UNL_Yang_lab/N_treatment_Jing/05Conbine_GWAS_Sele_GCTB_hmp/Chr5/genotype/hapmap_analysis/282_block_hap")
library(data.table)
g=fread("Block.txt", header=T,data.table=F)
id=fread("282_pop_structure.txt", header=F,data.table=F)
nss=id[id[,2]=="nss",1]
ss=id[id[,2]=="ss",1]
d=fread("Glu.hmp321_282_agpv4_maf005_miss03.vcf2", header=T,data.table=F)
res=NULL
i=3
g1=g[g[,6]==i,]
d1=d[d[,2]>=min(g1[,4]) & d[,2]<=max(g1[,4]),]
d2=d1[,-c(1:9)]
# Ward????????????
d3 <- dist(t(d2), method = "euclidean") # ??????????????????????????????????????????
fit2 <- hclust(d3, method="ward.D") #??????Ward????????????
plot(fit2) # ?????????????????????????????????
groups <- cutree(fit2, k=4) # ?????????????????????3
# ????????????3???????????????????????????
rect.hclust(fit2, k=4, border="red")
pdf("Blk3.pdf",height = 10,width = 35)
plot(fit2) # ?????????????????????????????????
groups <- cutree(fit2, k=4) # ?????????????????????3
# ????????????3???????????????????????????
rect.hclust(fit2, k=4, border="red")
dev.off()
grp=cbind(colnames(d2),groups)
colnames(grp)=c("ID","Hap")
write.table(grp,"blk3_hap.txt",col.names = T,row.names = F,quote = F,sep="\t")
table(grp[,2])
i=1
g1=g[g[,6]==i,]
d1=d[d[,2]>=min(g1[,4]) & d[,2]<=max(g1[,4]),]
d2=d1[,-c(1:9)]
# Ward????????????
d3 <- dist(t(d2), method = "euclidean") # ??????????????????????????????????????????
fit2 <- hclust(d3, method="ward.D") #??????Ward????????????
plot(fit2) # ?????????????????????????????????
groups <- cutree(fit2, k=3) # ?????????????????????3
# ????????????3???????????????????????????
rect.hclust(fit2, k=3, border="red")
pdf("Blk1.pdf",height = 10,width = 35)
plot(fit2) # ?????????????????????????????????
groups <- cutree(fit2, k=3) # ?????????????????????3
# ????????????3???????????????????????????
rect.hclust(fit2, k=3, border="red")
dev.off()
grp=cbind(colnames(d2),groups)
colnames(grp)=c("ID","Hap")
write.table(grp,"blk1_hap.txt",col.names = T,row.names = F,quote = F,sep="\t")
i=2
g1=g[g[,6]==i,]
d1=d[d[,2]>=min(g1[,4]) & d[,2]<=max(g1[,4]),]
d2=d1[,-c(1:9)]
# Ward????????????
d3 <- dist(t(d2), method = "euclidean") # ??????????????????????????????????????????
fit2 <- hclust(d3, method="ward.D") #??????Ward????????????
plot(fit2) # ?????????????????????????????????
groups <- cutree(fit2, k=4) # ?????????????????????3
# ????????????3???????????????????????????
rect.hclust(fit2, k=4, border="red")
table(grp[,2])
grp=cbind(colnames(d2),groups)
colnames(grp)=c("ID","Hap")
table(grp[,2])
pdf("Blk2.pdf",height = 10,width = 35)
plot(fit2) # ?????????????????????????????????
groups <- cutree(fit2, k=4) # ?????????????????????3
# ????????????3???????????????????????????
rect.hclust(fit2, k=4, border="red")
dev.off()
grp=cbind(colnames(d2),groups)
colnames(grp)=c("ID","Hap")
table(grp[,2])
write.table(grp,"blk2_hap.txt",col.names = T,row.names = F,quote = F,sep="\t")
i'
)
))}
}}
)))
table(grp[,2])
''
i=3
g1=g[g[,6]==i,]
d1=d[d[,2]>=min(g1[,4]) & d[,2]<=max(g1[,4]),]
d2=d1[,-c(1:9)]
# Ward????????????
d3 <- dist(t(d2), method = "euclidean") # ??????????????????????????????????????????
fit2 <- hclust(d3, method="ward.D") #??????Ward????????????
plot(fit2) # ?????????????????????????????????
i=5
g1=g[g[,6]==i,]
d1=d[d[,2]>=min(g1[,4]) & d[,2]<=max(g1[,4]),]
d2=d1[,-c(1:9)]
# Ward????????????
d3 <- dist(t(d2), method = "euclidean") # ??????????????????????????????????????????
fit2 <- hclust(d3, method="ward.D") #??????Ward????????????
plot(fit2) # ?????????????????????????????????
groups <- cutree(fit2, k=4) # ?????????????????????3
# ????????????3???????????????????????????
rect.hclust(fit2, k=4, border="red")
grp=cbind(colnames(d2),groups)
colnames(grp)=c("ID","Hap")
table(grp[,2])
pdf("Blk5.pdf",height = 10,width = 35)
plot(fit2) # ?????????????????????????????????
groups <- cutree(fit2, k=4) # ?????????????????????3
# ????????????3???????????????????????????
rect.hclust(fit2, k=4, border="red")
dev.off()
grp=cbind(colnames(d2),groups)
colnames(grp)=c("ID","Hap")
table(grp[,2])
write.table(grp,"blk5_hap.txt",col.names = T,row.names = F,quote = F,sep="\t")
i=6
g1=g[g[,6]==i,]
d1=d[d[,2]>=min(g1[,4]) & d[,2]<=max(g1[,4]),]
d2=d1[,-c(1:9)]
# Ward????????????
d3 <- dist(t(d2), method = "euclidean") # ??????????????????????????????????????????
fit2 <- hclust(d3, method="ward.D") #??????Ward????????????
plot(fit2) # ?????????????????????????????????
groups <- cutree(fit2, k=4) # ?????????????????????3
# ????????????3???????????????????????????
rect.hclust(fit2, k=4, border="red")
i
g1=g[g[,6]==i,]
d1=d[d[,2]>=min(g1[,4]) & d[,2]<=max(g1[,4]),]
d2=d1[,-c(1:9)]
# Ward????????????
d3 <- dist(t(d2), method = "euclidean") # ??????????????????????????????????????????
fit2 <- hclust(d3, method="ward.D") #??????Ward????????????
pdf("Blk6.pdf",height = 10,width = 35)
plot(fit2) # ?????????????????????????????????
groups <- cutree(fit2, k=4) # ?????????????????????3
# ????????????3???????????????????????????
rect.hclust(fit2, k=4, border="red")
dev.off()
grp=cbind(colnames(d2),groups)
colnames(grp)=c("ID","Hap")
table(grp[,2])
write.table(grp,"blk6_hap.txt",col.names = T,row.names = F,quote = F,sep="\t")
setwd("E:/UNL_Yang_lab/N_treatment_Jing/05Conbine_GWAS_Sele_GCTB_hmp/Chr5/genotype/hapmap_analysis/282_block_hap/block_GWAS_Tassel")
i=1
inf=qq("blk{i}_hap.txt")
d=fread(inf, header=T,data.table=F)
View(d)
inf
re=fread("blk1_hap.txt", header=T,data.table=F)
re=fread("blk1_hap.txt", header=T,data.table=F)[,1]
head(d)
ID=fread("blk1_hap.txt", header=T,data.table=F)[,1]
length(uniq(d[,2]))*(length(uniq(d[,2]))-1)/2
length(unique(d[,2]))*(length(unique(d[,2]))-1)/2
hap=d[,2]
for(j in 1:length(unique(hap))*(length(unique(hap))-1)/2)
{
d=cbind(d,hap)
}
View(d)
head(d)
p=length(unique(hap))*(length(unique(hap))-1)/2
d=fread(inf, header=T,data.table=F)
hap=d[,2]
p=length(unique(hap))*(length(unique(hap))-1)/2
for(j in 2:p)
{
d=cbind(d,hap)
}
View(d)
colnames(d)=c("ID",qq("BK{i}_{1:p}"))
head(d)
x=combn(1:p,2)
x
combn(1:4,2)
x1=x[,i]
x1
x=combn(1:p,2)
head(d)
p=ncol(combn(1:unique(hap),2))
p=ncol(combn(1:length(unique(hap)),2))
x1=x[,k]
c1=k+1
k=1
x1=x[,k]
c1=k+1
d[!d[,c1]%in%x1,c1]=NA
View(d)
qq("BK{i}_{x1}"
)
mk=paste(x1,sep="_")
mk=paste(x1,collapse ="_")
colnames(d)[c1]=qq("BK{i}_{mk}")
View(d)
x=combn(1:p,2)
for(k in 1:ncol(x))
{
x1=x[,k]
c1=k+1
d[!d[,c1]%in%x1,c1]=NA
mk=paste(x1,collapse ="_")
colnames(d)[c1]=qq("BK{i}_{mk}")
}
View(d)
ID=merge(ID,d,by=1)
View(ID)
ID=fread("blk1_hap.txt", header=T,data.table=F)[,1]
for(i in 1:6)
{
inf=qq("blk{i}_hap.txt")
d=fread(inf, header=T,data.table=F)
hap=d[,2]
p=ncol(combn(1:length(unique(hap)),2))
for(j in 2:p)
{
d=cbind(d,hap)
}
x=combn(1:p,2)
for(k in 1:ncol(x))
{
x1=x[,k]
c1=k+1
d[!d[,c1]%in%x1,c1]=NA
mk=paste(x1,collapse ="_")
colnames(d)[c1]=qq("BK{i}_{mk}")
}
ID=merge(ID,d,by=1)
}
inf=qq("blk{i}_hap.txt")
d=fread(inf, header=T,data.table=F)
hap=d[,2]
p=ncol(combn(1:length(unique(hap)),2))
for(j in 2:p)
{
d=cbind(d,hap)
}
View(d)
x=combn(1:p,2)
x
x=combn(1:max(hap),2)
x
ID=fread("blk1_hap.txt", header=T,data.table=F)[,1]
for(i in 1:6)
{
inf=qq("blk{i}_hap.txt")
d=fread(inf, header=T,data.table=F)
hap=d[,2]
p=ncol(combn(1:length(unique(hap)),2))
for(j in 2:p)
{
d=cbind(d,hap)
}
x=combn(1:max(hap),2)
for(k in 1:ncol(x))
{
x1=x[,k]
c1=k+1
d[!d[,c1]%in%x1,c1]=NA
mk=paste(x1,collapse ="_")
colnames(d)[c1]=qq("BK{i}_{mk}")
}
ID=merge(ID,d,by=1)
}
View(ID)
unique(ID[,2])
write.table(ID,"Block_geno.txt",col.names = T,row.names = F,sep="\t",quote=F)
i=2
d2=ID[,i]
mk=na.omit(d2)
mk=na.omit(unique(d2))
for(i in 2:ncol(ID))
{
d2=ID[,i]
mk=na.omit(unique(d2))
ID[ID[,i]==mk[1],i]="AA"
ID[ID[,i]==mk[2],i]="GG"
}
d2=ID[,i]
mk=na.omit(unique(d2))
ID[ID[,i]==mk[1],i]="AA"
mk[1]
View(ID)
ID[ID[,i]==mk[1],i][1:5,]
ID[,i]==mk[1]
View(ID)
which(ID[,i]==mk[1])[1:5]
ID[which(ID[,i]==mk[1]),i]="AA"
ID[which(ID[,i]==mk[2]),i]="GG"
View(ID)
ID=fread("Block_geno.txt", header=T,data.table=F)
View(ID)
for(i in 2:ncol(ID))
{
d2=ID[,i]
mk=na.omit(unique(d2))
ID[which(ID[,i]==mk[1]),i]="AA"
ID[which(ID[,i]==mk[2]),i]="GG"
}
View(ID)
d=t(ID)
View(d)
write.table(ID,"Block_geno_hmp.txt",col.names = T,row.names = F,sep="\t",quote=F)
View(ID)
write.table(d,"Block_geno_hmp.txt",col.names = T,row.names = F,sep="\t",quote=F)
write.table(d,"Block_geno_hmp.txt",col.names = T,row.names = T,sep="\t",quote=F)
setwd("E:/UNL_Yang_lab/N_treatment_Jing/05Conbine_GWAS_Sele_GCTB_hmp/Chr5/genotype/hapmap_analysis/282_block_hap/GL_phenotype")
library(Ropt)
blk4 <- read.table("blk4_hap.txt", header=TRUE,sep="\t")
blk3 <- read.table("blk3_hap.txt", header=TRUE,sep="\t")
pca=read.table("GEMMA_PCA.txt", header=T,sep="\t")
p=read.table("Phenotype.txt", header=TRUE,sep="\t")
View(pca)
View(p)
library("lme4")
setwd("E:/UNL_Yang_lab/N_treatment_Jing/05Conbine_GWAS_Sele_GCTB_hmp/Chr5/genotype/hapmap_analysis/282_block_hap/GL_phenotype")
library(Ropt)
blk4 <- read.table("blk4_hap.txt", header=TRUE,sep="\t")
blk3 <- read.table("blk3_hap.txt", header=TRUE,sep="\t")
pca=read.table("GEMMA_PCA.txt", header=F,sep="\t")[,-1]
p=read.table("Phenotype.txt", header=TRUE,sep="\t")
p_bk3=merge(blk3,p,by=1)
p_bk4=merge(blk4,p,by=1)
out=NULL
blk4 <- read.table("blk4_hap.txt", header=TRUE,sep="\t")
blk3 <- read.table("blk3_hap.txt", header=TRUE,sep="\t")
pca=read.table("GEMMA_PCA.txt", header=F,sep="\t")[,-1]
p=read.table("Phenotype.txt", header=TRUE,sep="\t")
p_bk3=merge(blk3,p,by=1)
p_bk4=merge(blk4,p,by=1)
out=NULL
for(i in 3:ncol(p_bk3))
{
d=na.omit(p_bk3[,c(2,i)])
h1=d[d[,1]==1,]
h2=d[d[,1]==2,]
h3=d[d[,1]==3,]
hap=d[, 1]
tra=d[,2]
fit <- lm(tra ~ as.factor(hap), data=d)
pval <- summary(fit)$coefficients[2,4]
tem <- data.frame(trait= names(d)[2], pval=pval, eff=summary(fit)$coefficients[2,1], std=summary(fit)$coefficients[2,2],Nhap1=nrow(h1),hap1=mean(h1[,2]),Nhap2=nrow(h2),hap2=mean(h2[,2]),Nhap3=nrow(h3),hap3=mean(h3[,2]))
out <- rbind(out, tem)
}
View(out)
library(Ropt)
blk4 <- read.table("blk4_hap.txt", header=TRUE,sep="\t")
blk3 <- read.table("blk3_hap.txt", header=TRUE,sep="\t")
pca=read.table("GEMMA_PCA.txt", header=F,sep="\t")[,-1]
p=read.table("Phenotype.txt", header=TRUE,sep="\t")
p_bk3=merge(blk3,p,by=1)
p_bk4=merge(blk4,p,by=1)
out=NULL
for(i in 3:ncol(p_bk3))
{
d=na.omit(p_bk3[,c(2,i)])
h1=d[d[,1]==1,]
h2=d[d[,1]==2,]
h3=d[d[,1]==3,]
hap=d[, 1]
tra=d[,2]
fit <- lm(tra ~ as.factor(hap), data=d)
pval <- summary(fit)$coefficients[2,4]
tem <- data.frame(trait= names(d)[2], pval=pval, eff=summary(fit)$coefficients[2,1], std=summary(fit)$coefficients[2,2],Nhap1=nrow(h1),hap1=mean(h1[,2]),Nhap2=nrow(h2),hap2=mean(h2[,2]),Nhap3=nrow(h3),hap3=mean(h3[,2]))
out <- rbind(out, tem)
}
write.table(out,"blk3_hap_GLM.txt",col.names = T,row.names = F,quote = F,sep="\t")
out=NULL
for(i in 3:ncol(p_bk4))
{
d=na.omit(p_bk4[,c(2,i)])
h1=d[d[,1]==1,]
h2=d[d[,1]==2,]
h3=d[d[,1]==3,]
hap=d[, 1]
tra=d[,2]
fit <- lm(tra ~ as.factor(hap), data=d)
pval <- summary(fit)$coefficients[2,4]
tem <- data.frame(trait= names(d)[2], pval=pval, eff=summary(fit)$coefficients[2,1], std=summary(fit)$coefficients[2,2],Nhap1=nrow(h1),hap1=mean(h1[,2]),Nhap2=nrow(h2),hap2=mean(h2[,2]),Nhap3=nrow(h3),hap3=mean(h3[,2]))
out <- rbind(out, tem)
}
write.table(out,"blk4_hap_GLM.txt",col.names = T,row.names = F,quote = F,sep="\t")
